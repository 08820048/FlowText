# 腾讯云COS集成指南

## 概述

FlowText现在支持腾讯云COS（对象存储）集成，允许处理大于5MB的音频文件进行语音识别。通过COS，您可以识别最大1GB的音频文件。

## 功能特性

### 文件大小支持
- **不配置COS**: 支持最大5MB的音频文件
- **配置COS**: 支持最大1GB的音频文件

### 自动处理流程
1. 检测音频文件大小
2. 如果文件 ≤ 5MB：直接上传到腾讯云ASR API
3. 如果文件 > 5MB：
   - 自动上传到配置的COS存储桶
   - 通过URL方式调用腾讯云录音文件识别API
   - 异步轮询识别结果

## 配置步骤

### 1. 获取腾讯云API密钥

1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 访问 **访问管理** → **访问密钥** → **API密钥管理**
3. 创建密钥并获取 `Secret ID` 和 `Secret Key`

### 2. 创建COS存储桶

1. 在腾讯云控制台访问 **对象存储COS**
2. 创建存储桶：
   - 选择合适的地域（建议与您的位置相近）
   - 设置存储桶名称（全局唯一）
   - 访问权限设置为 **公有读私有写** 或配置合适的访问策略

### 3. 在FlowText中配置

1. 打开FlowText应用
2. 进入 **设置** → **腾讯云** 标签页
3. 填写基本信息：
   - Secret ID
   - Secret Key
4. 填写COS配置（可选，用于大文件支持）：
   - **存储桶名称**: 您创建的存储桶名称
   - **地域**: 选择存储桶所在地域
   - **自定义域名**: （可选）如果配置了CDN加速域名
5. 点击 **保存** 按钮

## 使用方法

### 识别大文件

1. 导入视频文件
2. 选择 **腾讯云** 作为识别引擎
3. 点击 **开始识别**
4. 系统会自动：
   - 提取音频
   - 检测文件大小
   - 选择合适的上传方式
   - 显示详细的进度信息

### 进度显示

对于大文件识别，您会看到以下进度阶段：
1. **正在读取音频文件...**
2. **正在上传音频文件到腾讯云COS...** （仅大文件）
3. **COS上传完成，正在调用识别API...**
4. **正在等待识别完成...**
5. **识别完成**

## 支持的地域

- 北京（ap-beijing）
- 上海（ap-shanghai）
- 广州（ap-guangzhou）
- 成都（ap-chengdu）
- 重庆（ap-chongqing）
- 深圳金融（ap-shenzhen-fsi）
- 上海金融（ap-shanghai-fsi）
- 北京金融（ap-beijing-fsi）
- 香港（ap-hongkong）
- 新加坡（ap-singapore）
- 孟买（ap-mumbai）
- 首尔（ap-seoul）
- 曼谷（ap-bangkok）
- 东京（ap-tokyo）
- 硅谷（na-siliconvalley）
- 弗吉尼亚（na-ashburn）
- 多伦多（na-toronto）
- 法兰克福（eu-frankfurt）
- 莫斯科（eu-moscow）

## 错误处理

### 常见错误及解决方案

1. **"腾讯云API密钥未配置"**
   - 检查Secret ID和Secret Key是否正确填写

2. **"上传文件到COS失败"**
   - 检查存储桶名称和地域是否正确
   - 确认存储桶访问权限设置
   - 检查网络连接

3. **"腾讯云识别任务失败"**
   - 检查音频文件格式是否支持
   - 确认API配额是否充足

4. **"识别任务超时"**
   - 大文件识别可能需要较长时间
   - 检查网络连接稳定性

## 最佳实践

### 存储桶配置
- 选择与您地理位置相近的地域以获得更好的上传速度
- 配置生命周期规则自动删除临时音频文件
- 设置合适的访问权限，避免不必要的费用

### 文件处理
- 对于超大文件（>100MB），建议先进行音频压缩
- 支持的音频格式：WAV、MP3、M4A等
- 建议音频采样率：16kHz，单声道

### 成本优化
- COS存储和流量会产生费用
- 建议定期清理临时上传的音频文件
- 考虑使用COS的智能分层存储降低成本

## 技术细节

### 文件上传流程
1. 生成唯一的对象键：`audio/{UUID}/{filename}`
2. 使用腾讯云COS API v4签名算法
3. 支持断点续传（未来版本）

### 识别API调用
- 使用腾讯云录音文件识别API（CreateRecTask）
- 支持异步识别，最大等待时间10分钟
- 自动轮询识别状态（每10秒检查一次）

### 安全性
- 所有API调用使用HTTPS加密
- 临时文件使用UUID命名，避免冲突
- 支持自定义域名，可配置CDN加速

## 故障排除

如果遇到问题，请检查：
1. 网络连接是否正常
2. 腾讯云账户余额是否充足
3. API密钥是否有效
4. 存储桶配置是否正确
5. 音频文件格式是否支持

更多技术支持，请参考腾讯云官方文档或联系技术支持。
